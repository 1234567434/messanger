<!DOCTYPE html><html lang="en"><head>    <meta charset="UTF-8">    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">    <title>Cyber Chat Final - 7044xxx</title>    <style>        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }        body { margin: 0; background: #000; color: #fff; font-family: sans-serif; height: 100vh; display: flex; overflow: hidden; }        #sidebar { width: 300px; background: #0a0a0a; border-right: 1px solid #333; display: flex; flex-direction: column; transition: 0.3s; z-index: 1000; }        #main { flex: 1; display: flex; flex-direction: column; position: relative; background: #000; width: 100%; }        @media (max-width: 768px) {            #sidebar { position: fixed; left: -100%; top: 0; bottom: 0; width: 85%; box-shadow: 10px 0 20px rgba(0,0,0,0.5); }            #sidebar.open { left: 0; }        }        #modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.8); display: none; align-items: center; justify-content: center; z-index: 10000; padding: 20px; }        .modal { background: #111; border: 2px solid #007aff; border-radius: 20px; padding: 25px; width: 100%; max-width: 320px; text-align: center; }        .modal-btn { margin-top: 10px; padding: 12px 25px; border-radius: 12px; border: none; cursor: pointer; font-weight: bold; width: 100%; }        #auth { position: fixed; inset: 0; background: #000; z-index: 9000; display: flex; align-items: center; justify-content: center; padding: 20px; }        .card { background: #111; padding: 30px; border: 1px solid #007aff; border-radius: 20px; text-align: center; width: 100%; max-width: 350px; }        #chat { flex: 1; overflow-y: auto; padding: 15px; display: flex; flex-direction: column; gap: 12px; }        .msg-wrap { display: flex; gap: 8px; max-width: 92%; align-self: flex-start; }        .own { align-self: flex-end; flex-direction: row-reverse; }        .user-ava { width: 38px; height: 38px; border-radius: 50%; border: 1px solid #007aff; object-fit: cover; flex-shrink: 0; }        .msg-box { background: #1a1a1a; padding: 10px 14px; border-radius: 18px; border: 1px solid #333; font-size: 14px; overflow-wrap: break-word; }        .own .msg-box { background: #007aff; border: none; }        #emoji-panel { display: none; position: absolute; bottom: 75px; left: 10px; right: 10px; background: #111; border: 1px solid #007aff; border-radius: 20px; max-height: 40vh; overflow-y: auto; padding: 10px; grid-template-columns: repeat(auto-fill, minmax(50px, 1fr)); gap: 8px; z-index: 2000; }        .emoji-item { font-size: 32px; cursor: pointer; text-align: center; padding: 5px; }        #input-area { padding: 10px; display: flex; gap: 8px; background: #0a0a0a; border-top: 1px solid #333; align-items: center; }        .btn-icon { width: 42px; height: 42px; background: #1a1a1a; border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; border: 1px solid #333; flex-shrink: 0; }        input[type="text"] { background: #111; border: 1px solid #333; color: #fff; padding: 12px 15px; border-radius: 25px; outline: none; flex: 1; min-width: 0; font-size: 16px; }        .friend-item { display: flex; justify-content: space-between; align-items: center; padding: 15px; border-bottom: 1px solid #111; cursor: pointer; }        .friend-item:hover { background: #111; }        .del-friend { color: #ff4b4b; padding: 5px 10px; font-weight: bold; font-size: 18px; }        .react-badge { background: rgba(255,255,255,0.08); padding: 3px 8px; border-radius: 12px; font-size: 12px; cursor: pointer; margin-top: 4px; }    </style></head><body><div id="modal-overlay">    <div class="modal">        <h3 id="modal-text" style="margin-top:0"></h3>        <button id="modal-confirm" class="modal-btn" style="background:#ff4b4b; color:white; width:100%"></button>        <button id="modal-cancel" onclick="closeModal()" class="modal-btn" style="background:#333; color:white; width:100%"></button>    </div></div><div id="auth"><div class="card"><h2 id="t-login" style="color:#007aff"></h2><input type="text" id="n-in"><input type="file" id="a-in" accept="image/*" style="margin:15px 0; width:100%"><button id="b-login" onclick="login()" style="width:100%; padding:15px; background:#007aff; border:none; color:white; border-radius:15px; cursor:pointer; font-weight:bold;"></button></div></div><div id="sidebar">    <div style="padding:20px; border-bottom:1px solid #333;"><h3 id="my-name" style="color:#007aff; margin:0">Profile</h3><input type="text" id="f-search" style="width:100%; margin-top:10px; background:#000; border:1px solid #333; color:#fff; padding:10px; border-radius:12px;" oninput="searchUsers(this.value)"><div id="search-results" style="background:#111; position:absolute; width:260px; z-index:100;"></div></div>    <div id="friends-list" style="flex:1; overflow-y:auto;"></div></div><div id="main">    <div style="background:#0f0f0f; padding:12px 15px; display:flex; align-items:center; gap:12px; border-bottom:1px solid #222;"><div onclick="toggleSidebar()" style="cursor:pointer; font-size:24px;">?</div><span id="chat-title">Global Chat</span></div>    <div id="chat"></div>    <div id="emoji-panel"></div>    <div id="input-area">        <input type="file" id="f-upload" style="display:none">        <div class="btn-icon" onclick="document.getElementById('f-upload').click()"><svg viewBox="0 0 24 24" width="20" fill="white"><path d="M16.5 6v11.5c0 2.21-1.79 4-4 4s-4-1.79-4-4V5c0-1.38 1.12-2.5 2.5-2.5s2.5 1.12 2.5 2.5v10.5c0 .55-.45 1-1 1s-1-.45-1-1V6H10v9.5c0 1.38 1.12 2.5 2.5 2.5s2.5-1.12 2.5-2.5V5c0-2.21-1.79-4-4-4S7 2.79 7 5v12.5c0 3.31 2.69 6 6 6s6-2.69 6-6V6h-1.5z"/></svg></div>        <div class="btn-icon" id="v-btn"><svg viewBox="0 0 24 24" width="20" fill="white"><path d="M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3z"/><path d="M17 11c0 2.76-2.24 5-5 5s-5-2.24-5-5H5c0 3.53 2.61 6.43 6 6.92V21h2v-3.08c3.39-.49 6-3.39 6-6.92h-2z"/></svg></div>        <div class="btn-icon" onclick="openEmojiFor('text')" id="emo-btn" style="font-size:22px;"></div>        <input type="text" id="m-in" autocomplete="off">        <button id="b-send" onclick="send('text')" style="background:#007aff; border:none; color:white; padding:0 18px; border-radius:20px; height:42px; cursor:pointer; font-weight:bold;"></button>    </div></div><script>    window.txt = {        loginTitle: "\u0412\u0445\u043e\u0434", nickPh: "\u041d\u0438\u043a...", loginBtn: "\u0412\u041e\u0419\u0422\u0418",        searchPh: "\u041f\u043e\u0438\u0441\u043a...", globalChat: "\u0413\u043b\u043e\u0431\u0430\u043b",        msgPh: "\u0422\u0435\u043a\u0441\u0442...", sendBtn: "\u041e\u041a",        del: "\u0423\u0434\u0430\u043b\u0438\u0442\u044c", cancel: "\u041e\u0442\u043c\u0435\u043d\u0430", confirmQ: "\u0423\u0434\u0430\u043b\u0438\u0442\u044c \u044d\u0442\u043e?"    };    window.closeModal = () => document.getElementById('modal-overlay').style.display = 'none';</script><script type="module">    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";    import { getDatabase, ref, push, onValue, remove, update, set } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";    const cfg = { apiKey: "AIzaSyDsk3_aNh_KNtS_Rr1E7R0rysM-LpgMr1s", authDomain: "abovus-d72c9.firebaseapp.com", projectId: "abovus-d72c9", databaseURL: "https://abovus-d72c9-default-rtdb.firebaseio.com", appId: "1:611416635384:web:743ea00231140bf159c80d" };    const app = initializeApp(cfg); const db = getDatabase(app);    let user = JSON.parse(localStorage.getItem('cyber_v17'));    let curChat = 'global'; let emojiMode = 'text'; let targetMsgId = null;    document.getElementById('t-login').innerText = txt.loginTitle;    document.getElementById('n-in').placeholder = txt.nickPh;    document.getElementById('b-login').innerText = txt.loginBtn;    document.getElementById('f-search').placeholder = txt.searchPh;    document.getElementById('m-in').placeholder = txt.msgPh;    document.getElementById('b-send').innerText = txt.sendBtn;    document.getElementById('modal-cancel').innerText = txt.cancel;    document.getElementById('emo-btn').innerText = String.fromCodePoint(0x1F60A);    window.triggerDelete = (path, isMsg = true) => {        document.getElementById('modal-text').innerText = isMsg ? txt.confirmQ : "\u0423\u0434\u0430\u043b\u0438\u0442\u044c \u0434\u0438\u0430\u043b\u043e\u0433?";        document.getElementById('modal-confirm').innerText = txt.del;        document.getElementById('modal-confirm').onclick = () => {            remove(ref(db, path));            if(!isMsg) setChat('global', 'Global Chat');            closeModal();        };        document.getElementById('modal-overlay').style.display = 'flex';    };    const emojiList = [0x1F602, 0x1F62D, 0x1F495, 0x1F60D, 0x1F60E, 0x1F60A, 0x2764, 0x1F44D, 0x1F525, 0x1F44C].map(c => String.fromCodePoint(c));    const panel = document.getElementById('emoji-panel');    emojiList.forEach(emo => {        const s = document.createElement('span'); s.className = 'emoji-item'; s.innerText = emo;        s.onclick = () => {            if(emojiMode === 'text') document.getElementById('m-in').value += emo;            else { update(ref(db, curChat + '/' + targetMsgId + '/reacts/' + emo + '/' + user.id), { u: true }); panel.style.display = 'none'; }        };        panel.appendChild(s);    });    window.openEmojiFor = (mode, mid = null) => { emojiMode = mode; targetMsgId = mid; panel.style.display = panel.style.display === 'grid' ? 'none' : 'grid'; };    window.toggleSidebar = () => document.getElementById('sidebar').classList.toggle('open');        window.login = () => {        const n = document.getElementById('n-in').value.trim(); const f = document.getElementById('a-in').files[0]; if(!n) return;        const start = (ava = '') => {            const id = n.toLowerCase().replace(/\s/g,'');            const userData = { id, nick: n, ava: ava || 'https://cdn-icons-png.flaticon.com/512/149/149071.png' };            user = userData;            localStorage.setItem('cyber_v17', JSON.stringify(user));            // ÄÎÁÀÂËÅÍÈÅ Â ÎÁÙÈÉ ÑÏÈÑÎÊ ÏÎËÜÇÎÂÀÒÅËÅÉ ÏÐÈ ÐÅÃÈÑÒÐÀÖÈÈ            set(ref(db, 'all_users/' + id), { nick: n, id: id, ava: user.ava });             location.reload();        };        if(f) { const r = new FileReader(); r.onload = (e) => start(e.target.result); r.readAsDataURL(f); } else start();    };    if(user) { document.getElementById('auth').style.display = 'none'; document.getElementById('my-name').innerText = user.nick; loadChat(); loadFriends(); }    function loadFriends() {        onValue(ref(db, 'users/' + user.id + '/friends'), (s) => {            const l = document.getElementById('friends-list');             l.innerHTML = `<div class="friend-item" style="color:#007aff;" onclick="setChat('global', 'Global Chat'); toggleSidebar();">\uD83C\uDF0D ${txt.globalChat}</div>`;            s.forEach(f => {                const ud = f.val(); const d = document.createElement('div'); d.className = 'friend-item';                d.innerHTML = `<span>\uD83D\uDC64 ${ud.nick}</span><span class="del-friend" onclick="event.stopPropagation(); triggerDelete('users/${user.id}/friends/${f.key}', false)">\u00D7</span>`;                d.onclick = () => { setChat('private_' + [user.id, f.key].sort().join('_'), ud.nick); toggleSidebar(); };                l.appendChild(d);            });        });    }    window.searchUsers = (v) => {        const res = document.getElementById('search-results'); if(!v) { res.style.display = 'none'; return; }        onValue(ref(db, 'all_users'), (s) => {            res.innerHTML = ''; res.style.display = 'block';            s.forEach(u => { const ud = u.val(); if(ud.nick.toLowerCase().includes(v.toLowerCase()) && ud.id !== user.id) {                const i = document.createElement('div'); i.style="padding:12px; background:#222; margin:2px; cursor:pointer; border-radius:8px;"; i.innerText = '+ ' + ud.nick;                i.onclick = () => { update(ref(db, 'users/' + user.id + '/friends/' + ud.id), { nick: ud.nick }); res.style.display = 'none'; document.getElementById('f-search').value = ''; };                res.appendChild(i);            }});        }, { onlyOnce: true });    };    function loadChat() {        onValue(ref(db, curChat), (s) => {            const b = document.getElementById('chat'); b.innerHTML = '';            s.forEach(child => {                const m = child.val(); const mid = child.key; const own = m.uid === user.id;                let body = m.type === 'text' ? m.val : (m.type === 'img' ? `<img src="${m.val}" style="max-width:100%; border-radius:15px;">` : `<audio src="${m.val}" controls style="filter:invert(1); width:200px; height:35px;"></audio>`);                let rTags = '';                if(m.reacts) Object.keys(m.reacts).forEach(emo => { rTags += `<div class="react-badge" onclick="update(ref(db, '${curChat}/${mid}/reacts/${emo}/${user.id}'), {u:true})">${emo} ${Object.keys(m.reacts[emo]).length}</div>`; });                const d = document.createElement('div'); d.className = `msg-wrap ${own ? 'own' : ''}`;                d.innerHTML = `<img src="${m.ava}" class="user-ava"><div><div style="font-size:10px; color:#555; margin-bottom:2px;">${m.nick}</div><div class="msg-box">${body}</div><div class="react-bar"><div class="react-badge" onclick="openEmojiFor('react', '${mid}')">+</div>${rTags}${own ? `<span style="font-size:10px; color:#ff4b4b; cursor:pointer; margin-left:10px; padding:5px;" onclick="triggerDelete('${curChat}/${mid}')">${txt.del}</span>` : ''}</div></div>`;                b.appendChild(d);            });            b.scrollTop = b.scrollHeight;        });    }    window.setChat = (c, t) => { curChat = c; document.getElementById('chat-title').innerText = t; loadChat(); };    window.send = (t, v = null) => {        const val = v || document.getElementById('m-in').value; if(!val) return;        push(ref(db, curChat), { uid: user.id, nick: user.nick, ava: user.ava, type: t, val: val });        document.getElementById('m-in').value = ''; panel.style.display = 'none';    };    document.getElementById('f-upload').onchange = (e) => {        const f = e.target.files[0]; if(!f) return;        const r = new FileReader(); r.onload = () => { if(f.type.startsWith('image/')) send('img', r.result); }; r.readAsDataURL(f);    };    let rec; let chunks = [];    document.getElementById('v-btn').onclick = async () => {        const btn = document.getElementById('v-btn');        if(!rec) {            const s = await navigator.mediaDevices.getUserMedia({ audio: true }); rec = new MediaRecorder(s);            rec.ondataavailable = e => chunks.push(e.data);            rec.onstop = () => { const r = new FileReader(); r.onload = () => send('aud', r.result); r.readAsDataURL(new Blob(chunks, { type: 'audio/mp3' })); chunks = []; };            rec.start(); btn.classList.add('active-rec');        } else { rec.stop(); rec = null; btn.classList.remove('active-rec'); }    };</script></body></html>